<div class="application-status-container">
  <!-- Header -->
  <div class="status-header">
    <div class="header-content">
      <h1>
        <i class="pi pi-file-o"></i>
        Application Status
      </h1>
      <p class="subtitle">Track your admission application progress</p>
    </div>
    <p-button
      label="Refresh"
      icon="pi pi-refresh"
      (onClick)="refreshStatus()"
      severity="secondary"
      [outlined]="true"
    ></p-button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <p-progressSpinner></p-progressSpinner>
    <p>Loading application status...</p>
  </div>

  <!-- No Application Found -->
  <div *ngIf="!loading && !applicationStatus" class="no-application">
    <div class="empty-state">
      <i class="pi pi-file-o empty-icon"></i>
      <h3>No Application Found</h3>
      <p>You haven't submitted an application yet.</p>
      <p-button
        label="Start Application"
        icon="pi pi-plus"
        (onClick)="router.navigate(['/admission'])"
        severity="primary"
      ></p-button>
    </div>
  </div>

  <!-- Application Status Display -->
  <div *ngIf="!loading && applicationStatus" class="status-content">
    <!-- Application Info Card -->
    <p-card styleClass="application-info-card">
      <div class="application-header">
        <div class="app-info">
          <h2>Application #{{ applicationStatus.applicationId }}</h2>
          <p class="submitted-date">
            Submitted on {{ formatDate(applicationStatus.submittedDate) }}
          </p>
          <p
            *ngIf="applicationStatus.resubmissionCount > 0"
            class="resubmission-count"
          >
            <i class="pi pi-refresh"></i>
            Resubmitted {{ applicationStatus.resubmissionCount }} time(s)
          </p>
        </div>
        <div class="status-badge">
          <p-tag
            [value]="applicationStatus.status.replace('_', ' ').toUpperCase()"
            [severity]="getStatusColor()"
            [rounded]="true"
          ></p-tag>
        </div>
      </div>
    </p-card>

    <!-- Status Progress -->
    <p-card styleClass="progress-card" *ngIf="!isRejected()">
      <ng-template pTemplate="header">
        <div class="card-header">
          <h3>Application Progress</h3>
        </div>
      </ng-template>

      <p-steps
        [model]="statusSteps"
        [activeIndex]="getStatusIndex()"
        [readonly]="true"
        styleClass="status-steps"
      ></p-steps>

      <div class="progress-info" *ngIf="applicationStatus.reviewedDate">
        <p>
          <i class="pi pi-clock"></i>
          Last updated: {{ formatDate(applicationStatus.lastUpdated) }}
        </p>
        <p *ngIf="applicationStatus.reviewedBy">
          <i class="pi pi-user"></i>
          Reviewed by: {{ applicationStatus.reviewedBy }}
        </p>
      </div>
    </p-card>

    <!-- Rejection Notice -->
    <p-card styleClass="rejection-card" *ngIf="isRejected()">
      <ng-template pTemplate="header">
        <div class="card-header rejection-header">
          <h3>
            <i class="pi pi-times-circle"></i>
            Application Rejected
          </h3>
        </div>
      </ng-template>

      <div class="rejection-content">
        <p class="rejection-reason">
          <strong>Reason for Rejection:</strong>
          {{
            applicationStatus.rejectionReason || "No specific reason provided."
          }}
        </p>

        <div class="rejection-actions">
          <p>
            You can review and edit your application to address the issues
            mentioned above.
          </p>
          <p-button
            label="Edit & Resubmit Application"
            icon="pi pi-pencil"
            (onClick)="editApplication()"
            severity="primary"
          ></p-button>
        </div>
      </div>
    </p-card>

    <!-- Payment Section -->
    <p-card styleClass="payment-card" *ngIf="canMakePayment() || isEnrolled()">
      <ng-template pTemplate="header">
        <div class="card-header">
          <h3>
            <i class="pi pi-credit-card"></i>
            Fee Payment
          </h3>
        </div>
      </ng-template>

      <div class="payment-content">
        <div *ngIf="paymentDetails" class="payment-info">
          <div class="payment-amount">
            <h4>Total Amount: â‚¹{{ paymentDetails.amount | number }}</h4>
            <p class="due-date">
              <i class="pi pi-calendar"></i>
              Due Date: {{ formatDate(paymentDetails.dueDate) }}
            </p>
          </div>

          <div class="payment-status">
            <p-tag
              [value]="paymentDetails.status.toUpperCase()"
              [severity]="
                paymentDetails.status === 'completed' ? 'success' : 'warn'
              "
            ></p-tag>
          </div>
        </div>

        <div class="payment-actions">
          <p-button
            *ngIf="canMakePayment()"
            label="Proceed to Payment"
            icon="pi pi-credit-card"
            (onClick)="proceedToPayment()"
            severity="primary"
            size="large"
          ></p-button>

          <div *ngIf="isEnrolled()" class="enrollment-success">
            <p>
              <i class="pi pi-check-circle"></i>
              Payment completed successfully! You are now enrolled.
            </p>
            <p-button
              label="Access Student Dashboard"
              icon="pi pi-th-large"
              (onClick)="accessDashboard()"
              severity="success"
              size="large"
            ></p-button>
          </div>
        </div>
      </div>
    </p-card>

    <!-- Document Status -->
    <p-card
      styleClass="documents-card"
      *ngIf="applicationStatus.documents?.length > 0"
    >
      <ng-template pTemplate="header">
        <div class="card-header">
          <h3>
            <i class="pi pi-file"></i>
            Document Status
          </h3>
        </div>
      </ng-template>

      <div class="documents-list">
        <div
          *ngFor="let doc of applicationStatus.documents"
          class="document-item"
        >
          <div class="doc-info">
            <i class="pi pi-file-pdf"></i>
            <div class="doc-details">
              <p class="doc-name">{{ doc.documentType }}</p>
              <p class="doc-filename">{{ doc.fileName }}</p>
            </div>
          </div>
          <div class="doc-status">
            <p-tag
              [value]="doc.status.toUpperCase()"
              [severity]="
                doc.status === 'approved'
                  ? 'success'
                  : doc.status === 'rejected'
                    ? 'danger'
                    : 'warning'
              "
            ></p-tag>
            <p *ngIf="doc.rejectionReason" class="rejection-reason">
              {{ doc.rejectionReason }}
            </p>
          </div>
        </div>
      </div>
    </p-card>

    <!-- Notifications -->
    <p-card styleClass="notifications-card" *ngIf="notifications.length > 0">
      <ng-template pTemplate="header">
        <div class="card-header">
          <h3>
            <i class="pi pi-bell"></i>
            Recent Notifications
          </h3>
        </div>
      </ng-template>

      <div class="notifications-list">
        <div
          *ngFor="let notification of notifications"
          class="notification-item"
          [class.unread]="!notification.isRead"
          (click)="markNotificationRead(notification)"
        >
          <div class="notification-icon">
            <i [class]="'pi ' + getNotificationIcon(notification.type)"></i>
          </div>
          <div class="notification-content">
            <h4>{{ notification.title }}</h4>
            <p>{{ notification.message }}</p>
            <span class="notification-date">
              {{ formatDate(notification.createdDate) }}
            </span>
          </div>
          <div class="notification-badge" *ngIf="!notification.isRead">
            <span class="unread-dot"></span>
          </div>
        </div>
      </div>
    </p-card>
  </div>
</div>

<p-toast></p-toast>
